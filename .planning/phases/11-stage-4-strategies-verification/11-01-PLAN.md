---
phase: 11-stage-4-strategies-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/fixtures/stage-4-strategies.ts
  - backend/src/fixtures/index.ts
autonomous: true
requirements:
  - STRAT-01
must_haves:
  truths:
    - "stage-4-strategies fixture loads via getFixture('stage-4-strategies')"
    - "Fixture provides chat responses compatible with SessionBuilder NEED_MAPPING_COMPLETE setup"
    - "Fixture is registered in fixtureRegistry and available by ID"
  artifacts:
    - path: "backend/src/fixtures/stage-4-strategies.ts"
      provides: "Stage 4 fixture with chat responses for SessionBuilder compatibility"
      min_lines: 50
    - path: "backend/src/fixtures/index.ts"
      provides: "Registry entry for stage-4-strategies fixture"
      contains: "stage-4-strategies"
  key_links:
    - from: "backend/src/fixtures/stage-4-strategies.ts"
      to: "backend/src/fixtures/index.ts"
      via: "import and registry entry"
      pattern: "stage4Strategies"
---

<objective>
Create a deterministic E2E fixture for Stage 4 (Strategic Repair) testing and register it in the fixture registry.

Purpose: Stage 4 E2E tests need a fixture ID set on browser contexts for SessionBuilder compatibility. Since AI strategy suggestions are a TODO (returns empty), strategies will be proposed manually via API. The fixture primarily provides chat responses needed when SessionBuilder sets up the session through Stages 0-3.

Output: `backend/src/fixtures/stage-4-strategies.ts` registered in fixture index.
</objective>

<execution_context>
@/Users/shantam/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shantam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-stage-3-needs-verification/10-01-SUMMARY.md
@backend/src/fixtures/stage-3-needs.ts
@backend/src/fixtures/index.ts
@backend/src/fixtures/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create stage-4-strategies fixture and register in index</name>
  <files>backend/src/fixtures/stage-4-strategies.ts, backend/src/fixtures/index.ts</files>
  <action>
Create `backend/src/fixtures/stage-4-strategies.ts` following the exact pattern of `stage-3-needs.ts`:

1. **responses array**: Copy all 7 chat responses from `stage-3-needs.ts` (witnessing through empathy building). These are needed because SessionBuilder sets the fixture ID on user contexts and stages 0-2 chat still references the fixture even when starting at NEED_MAPPING_COMPLETE.

2. **operations object**: Include the same `extract-needs` and `common-ground` operations from `stage-3-needs.ts`. These are needed because SessionBuilder at NEED_MAPPING_COMPLETE may trigger Stage 3 operations during setup.

3. **seed**: Include a seed user entry following the pattern:
```typescript
seed: {
  users: [{
    id: 'user-stage4',
    email: 'stage4@e2e.test',
    clerkId: 'e2e_clerk_stage4',
    name: 'Stage4 User',
  }],
},
```

4. **Export**: Named export `stage4Strategies` with type `E2EFixture`.

Register in `backend/src/fixtures/index.ts`:
- Add import: `import { stage4Strategies } from './stage-4-strategies';`
- Add to named exports
- Add to `fixtureRegistry` with ID `'stage-4-strategies'`

NOTE: The AI suggestions endpoint (POST /strategies/suggestions) is a TODO in the backend that returns empty. The E2E test will propose strategies manually via POST /strategies. No operation mock is needed for strategy generation.
  </action>
  <verify>
Run: `cd /Users/shantam/Software/meet-without-fear && npm run check`
Then verify fixture loads:
```bash
cd /Users/shantam/Software/meet-without-fear/backend && npx tsx -e "
const { getFixture } = require('./src/fixtures');
const f = getFixture('stage-4-strategies');
console.log('Loaded:', !!f);
console.log('Name:', f?.name);
console.log('Responses:', f?.responses?.length);
console.log('Operations:', f?.operations ? Object.keys(f.operations) : 'none');
"
```
  </verify>
  <done>
Fixture 'stage-4-strategies' loads from registry, has 7 chat responses, and includes extract-needs and common-ground operations. TypeScript compilation passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run check` passes across all workspaces
2. `getFixture('stage-4-strategies')` returns a valid fixture object
3. Fixture has responses array with 7 entries (matching stage-3-needs pattern)
4. Fixture has operations object with 'extract-needs' and 'common-ground' keys
</verification>

<success_criteria>
- stage-4-strategies fixture registered and loadable
- TypeScript compilation passes
- Fixture follows established pattern from stage-3-needs
</success_criteria>

<output>
After completion, create `.planning/phases/11-stage-4-strategies-verification/11-01-SUMMARY.md`
</output>
