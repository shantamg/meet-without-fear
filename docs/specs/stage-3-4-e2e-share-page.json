{
  "name": "Stage 3-4 E2E Test with Share Page Migration",
  "slug": "stage-3-4-e2e-share-page",
  "created_at": "2026-02-03T08:02:13.508363",
  "status": "draft",
  "version": "1.0",
  "problem": {
    "statement": "Need E2E test to verify Stage 3 (Need Mapping) and Stage 4 (Strategic Repair) UI works end-to-end with visual screenshots at key decision points. Also need to migrate Stage 3/4 content from inline cards to Share page for consistency with Stage 2.",
    "users": "Developer (me) - using E2E as visual verification tool before deployment",
    "success_criteria": "Test runs from empathy reveal through resolution, captures screenshots of all key UI states, validates that Stage 3/4 content appears on Share page consistent with Stage 2 patterns"
  },
  "technical": {
    "components": [
      "Playwright E2E framework, Backend API, Mobile web app (Expo), Share page (/session/[id]/share.tsx), Chat indicators, Ably real",
      "time, Fixtures for mocked AI responses"
    ],
    "dependencies": [
      "Ably (real",
      "time), Backend API (localhost:3002), Expo web (localhost:8082), Existing DB/Clerk patterns from Stage 2 tests"
    ],
    "constraints": [
      "Must match Stage 1/2 UI patterns (chat/share split, indicator lines with arrows, pop",
      "ups, drawers). Start from empathy reveal (existing test endpoint). Use real Ably like existing tests"
    ]
  },
  "user_experience": {
    "primary_flow": "1. Both users at empathy reveal on Share page (validation buttons visible) \u2192 2. Both validate \u2192 indicator appears in chat \u2192 3. Navigate to Share page \u2192 Needs section visible \u2192 4. Adjust needs or confirm \u2192 indicator appears \u2192 5. Common ground revealed on Share page \u2192 6. Confirm \u2192 indicator appears \u2192 7. Strategy pool on Share page \u2192 8. Generate suggestions (function only) \u2192 9. Rank strategies \u2192 10. Overlap reveal on Share page \u2192 11. Agreement \u2192 indicator appears \u2192 12. Resolution",
    "edge_cases": [
      "Partner hasn't validated yet (waiting), User wants to adjust needs, No common ground found, No strategy overlap, Partner disconnects mid",
      "session"
    ],
    "design_constraints": "Must match Stage 2 patterns: Chat indicators with arrows that navigate to Share page, Share page as central hub for user-to-user content, Pop-ups for attention (like PartnerEventModal), Drawers for focused interactions"
  },
  "implementation": {
    "mvp": "Happy path only: Both users validate empathy \u2192 view needs on Share page \u2192 confirm \u2192 view common ground \u2192 view strategy pool \u2192 rank \u2192 view overlap \u2192 agree. Screenshots at each Share page state.",
    "future_phases": "Adjust needs flow with AI chat, Generate AI strategy suggestions with validation, Error state handling (offline, timeouts), Multiple fixture scenarios",
    "blockers": [
      "Stage 3/4 content currently in inline cards on UnifiedSessionScreen",
      "needs migration to Share page. Chat indicators for Stage 3/4 milestones not yet implemented"
    ]
  },
  "metadata": {
    "ai_notes": "Key architectural decision: Move Stage 3/4 from inline cards to Share page for consistency with Stage 2 pattern. Chat indicators should appear in chat flow (like 'empathy-shared', 'context-shared') and navigate to Share page. Share page becomes central hub for all user-to-user content across all stages. Stage 3 shows: NeedsSection, CommonGroundCard. Stage 4 shows: StrategyPool, StrategyRanking, OverlapReveal, AgreementCard.",
    "interview_completed": "2026-02-03T08:02:13.508559"
  },
  "raw_answers": {
    "problem": "Need E2E test to verify Stage 3 (Need Mapping) and Stage 4 (Strategic Repair) UI works end-to-end with visual screenshots at key decision points. Also need to migrate Stage 3/4 content from inline cards to Share page for consistency with Stage 2.",
    "users": "Developer (me) - using E2E as visual verification tool before deployment",
    "success": "Test runs from empathy reveal through resolution, captures screenshots of all key UI states, validates that Stage 3/4 content appears on Share page consistent with Stage 2 patterns",
    "components": "Playwright E2E framework, Backend API, Mobile web app (Expo), Share page (/session/[id]/share.tsx), Chat indicators, Ably real-time, Fixtures for mocked AI responses",
    "dependencies": "Ably (real-time), Backend API (localhost:3002), Expo web (localhost:8082), Existing DB/Clerk patterns from Stage 2 tests",
    "constraints": "Must match Stage 1/2 UI patterns (chat/share split, indicator lines with arrows, pop-ups, drawers). Start from empathy reveal (existing test endpoint). Use real Ably like existing tests.",
    "primary_flow": "1. Both users at empathy reveal on Share page (validation buttons visible) \u2192 2. Both validate \u2192 indicator appears in chat \u2192 3. Navigate to Share page \u2192 Needs section visible \u2192 4. Adjust needs or confirm \u2192 indicator appears \u2192 5. Common ground revealed on Share page \u2192 6. Confirm \u2192 indicator appears \u2192 7. Strategy pool on Share page \u2192 8. Generate suggestions (function only) \u2192 9. Rank strategies \u2192 10. Overlap reveal on Share page \u2192 11. Agreement \u2192 indicator appears \u2192 12. Resolution",
    "edge_cases": "Partner hasn't validated yet (waiting), User wants to adjust needs, No common ground found, No strategy overlap, Partner disconnects mid-session",
    "design_constraints": "Must match Stage 2 patterns: Chat indicators with arrows that navigate to Share page, Share page as central hub for user-to-user content, Pop-ups for attention (like PartnerEventModal), Drawers for focused interactions",
    "mvp": "Happy path only: Both users validate empathy \u2192 view needs on Share page \u2192 confirm \u2192 view common ground \u2192 view strategy pool \u2192 rank \u2192 view overlap \u2192 agree. Screenshots at each Share page state.",
    "future_phases": "Adjust needs flow with AI chat, Generate AI strategy suggestions with validation, Error state handling (offline, timeouts), Multiple fixture scenarios",
    "blockers": "Stage 3/4 content currently in inline cards on UnifiedSessionScreen - needs migration to Share page. Chat indicators for Stage 3/4 milestones not yet implemented."
  }
}